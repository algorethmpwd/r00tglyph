{% extends 'base.html' %}

{% block title %}SQL Injection Level 6 Solution - R00tGlyph{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h2 class="text-center">SQL Injection Level 6 Solution: SQL Injection with WAF Bypass</h2>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h4><i class="bi bi-info-circle-fill me-2"></i>Challenge Overview</h4>
                    <p>
                        This challenge demonstrates a SQL injection vulnerability in a product search feature that is protected by a Web Application Firewall (WAF). The application directly concatenates user input into SQL queries without proper sanitization, but the WAF blocks common SQL injection patterns. The challenge is to bypass the WAF and exploit the underlying vulnerability.
                    </p>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="bi bi-bug-fill me-2"></i>Vulnerability Explanation</h5>
                    </div>
                    <div class="card-body">
                        <p>
                            The vulnerability exists because the application constructs an SQL query by directly concatenating user input:
                        </p>
                        <pre class="bg-light p-3 rounded"><code>SELECT id, name, category, price, stock FROM products WHERE name LIKE '%search_term%'</code></pre>
                        <p>
                            However, a WAF is in place that blocks common SQL injection patterns, including:
                        </p>
                        <ul>
                            <li>Single quotes (<code>'</code>) and double quotes (<code>"</code>)</li>
                            <li>SQL comments (<code>--</code>, <code>#</code>, <code>/**/</code>)</li>
                            <li>Common SQL keywords like <code>UNION</code>, <code>SELECT</code>, <code>FROM</code>, etc.</li>
                        </ul>
                        <p>
                            To exploit this vulnerability, we need to bypass the WAF by using alternative syntax or encoding techniques.
                        </p>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="bi bi-code-slash me-2"></i>Solution</h5>
                    </div>
                    <div class="card-body">
                        <p>To exploit this vulnerability, we need to bypass the WAF using various techniques:</p>
                        
                        <h6>1. Case Variation</h6>
                        <p>
                            WAFs often look for specific keywords in a case-sensitive manner. By mixing uppercase and lowercase letters, we can bypass simple pattern matching:
                        </p>
                        <div class="alert alert-secondary">
                            <code>%' oR id=999 or '%'='</code>
                        </div>
                        <p>
                            Here, we use <code>oR</code> instead of <code>OR</code> to bypass the WAF.
                        </p>
                        
                        <h6>2. Alternate Encodings</h6>
                        <p>
                            URL encoding or hex encoding can be used to bypass WAFs that look for specific characters:
                        </p>
                        <div class="alert alert-secondary">
                            <code>%25%27%20OR%20id%3D999%20OR%20%27%25%27%3D%27</code>
                        </div>
                        <p>
                            This is the URL-encoded version of <code>%' OR id=999 OR '%'='</code>.
                        </p>
                        
                        <h6>3. SQL Keyword Splitting</h6>
                        <p>
                            Some WAFs look for complete SQL keywords. By splitting keywords, we can bypass these checks:
                        </p>
                        <div class="alert alert-secondary">
                            <code>%' O/**/R id=999 O/**/R '%'='</code>
                        </div>
                        <p>
                            Here, we split <code>OR</code> into <code>O/**/R</code> using a comment.
                        </p>
                        
                        <h6>4. Alternative SQL Syntax</h6>
                        <p>
                            Using alternative but equivalent SQL syntax can bypass WAFs that look for specific patterns:
                        </p>
                        <div class="alert alert-secondary">
                            <code>%' || id=999 || '%'='</code>
                        </div>
                        <p>
                            In many SQL dialects, <code>||</code> is equivalent to <code>OR</code>.
                        </p>
                        
                        <h6>5. Character Substitution</h6>
                        <p>
                            Some characters can be represented in different ways:
                        </p>
                        <div class="alert alert-secondary">
                            <code>%' OR ASCII(CHAR(57))=57 AND id=999 OR '%'='</code>
                        </div>
                        <p>
                            Here, <code>ASCII(CHAR(57))=57</code> is always true (57 is the ASCII code for '9').
                        </p>
                        
                        <h6>6. Combining Techniques</h6>
                        <p>
                            For more robust WAF bypass, combine multiple techniques:
                        </p>
                        <div class="alert alert-secondary">
                            <code>%' || (SeLeCt 1 FrOm DuAl WhErE 1=1 AnD id=999) || '%'='</code>
                        </div>
                        <p>
                            This combines case variation, alternative syntax, and SQL dialect-specific functions.
                        </p>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="bi bi-shield-fill-check me-2"></i>Prevention</h5>
                    </div>
                    <div class="card-body">
                        <p>To prevent SQL injection vulnerabilities, even with a WAF in place, developers should:</p>
                        <ol>
                            <li>
                                <strong>Use Parameterized Queries:</strong> Instead of concatenating strings, use prepared statements with parameter binding.
                                <pre class="bg-light p-3 rounded"><code>cursor.execute("SELECT id, name, category, price, stock FROM products WHERE name LIKE ?", ('%' + search_term + '%',))</code></pre>
                            </li>
                            <li>
                                <strong>Use an ORM (Object-Relational Mapping):</strong> ORMs like SQLAlchemy handle parameter sanitization automatically.
                            </li>
                            <li>
                                <strong>Input Validation:</strong> Validate and sanitize all user inputs before using them in queries.
                            </li>
                            <li>
                                <strong>Defense in Depth:</strong> Don't rely solely on a WAF - implement multiple layers of security.
                            </li>
                            <li>
                                <strong>Regular WAF Updates:</strong> Keep WAF rules updated to protect against new bypass techniques.
                            </li>
                        </ol>
                    </div>
                </div>
                
                <div class="mt-4">
                    <a href="{{ url_for('sqli_level6') }}" class="btn btn-primary"><i class="bi bi-arrow-left me-2"></i>Back to Challenge</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
