{% extends "base.html" %}

{% block title %}Command Injection Level 16 - Process Substitution{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h3><i class="bi bi-terminal me-2"></i>Command Injection Level 16</h3>
                    <div>
                        <button type="button" class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#challengeModal">
                            <i class="bi bi-info-circle me-1"></i>Challenge Info
                        </button>
                        <a href="{{ url_for('solutions', level='cmdi16') }}" class="btn btn-outline-secondary btn-sm">
                            <i class="bi bi-lightbulb me-1"></i>Solution
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="scenario-box mb-4">
                        <h5><i class="bi bi-gear me-2"></i>Linux Automation Platform</h5>
                        <p>You're testing an advanced Linux automation platform that executes shell scripts with complex parameters. The system supports process substitution and advanced shell features, creating opportunities for sophisticated command injection attacks.</p>
                        <p><strong>Context:</strong> Advanced Linux system automation and DevOps tools</p>
                        <p><strong>Technology:</strong> Bash, process substitution, shell scripting</p>
                        <p><strong>Complexity:</strong> Advanced shell injection techniques</p>
                    </div>

                    {% if flag %}
                    <div class="alert alert-success">
                        <i class="bi bi-flag-fill me-2"></i><strong>Challenge Completed!</strong>
                        <br>Flag: <code>{{ flag }}</code>
                    </div>
                    {% endif %}

                    <div class="alert alert-warning mb-4">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <strong>Advanced Level:</strong> This challenge requires knowledge of advanced shell features like process substitution and command expansion.
                    </div>

                    <form method="POST" class="mb-4">
                        <div class="mb-3">
                            <label for="automation_script" class="form-label">Automation Script:</label>
                            <input type="text" class="form-control" id="automation_script" name="automation_script" 
                                   value="{{ automation_script }}" placeholder="backup_database.sh">
                            <div class="form-text">Specify the automation script to execute.</div>
                        </div>
                        <div class="mb-3">
                            <label for="script_params" class="form-label">Script Parameters:</label>
                            <input type="text" class="form-control" id="script_params" name="script_params" 
                                   value="{{ script_params }}" placeholder="--target production --format tar.gz">
                            <div class="form-text">Enter parameters for the automation script.</div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-play me-2"></i>Execute Automation Script
                        </button>
                    </form>

                    {% if execution_result %}
                    <div class="card">
                        <div class="card-header">
                            <h6><i class="bi bi-terminal me-2"></i>Script Execution Output</h6>
                        </div>
                        <div class="card-body">
                            <pre class="command-output">{{ execution_result }}</pre>
                        </div>
                    </div>
                    {% endif %}

                    <div class="mt-4">
                        <h6>Advanced Injection Techniques:</h6>
                        <ul>
                            <li>Process substitution: <code>--input <(whoami)</code></li>
                            <li>Command substitution: <code>--target $(hostname)</code></li>
                            <li>Brace expansion: <code>--format {tar,zip}; id</code></li>
                            <li>Advanced shell features for complex attacks</li>
                        </ul>
                        
                        <h6>Process Substitution Context:</h6>
                        <p>Process substitution is an advanced shell feature that allows the output of commands to be used as file inputs. This creates sophisticated attack vectors in automation systems.</p>
                        
                        <h6>Real-World Automation Tools:</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <h6><i class="bi bi-gear me-2"></i>DevOps Tools</h6>
                                <ul>
                                    <li>Ansible automation</li>
                                    <li>Jenkins CI/CD</li>
                                    <li>GitLab runners</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="bi bi-server me-2"></i>System Tools</h6>
                                <ul>
                                    <li>Cron job automation</li>
                                    <li>System monitoring</li>
                                    <li>Backup systems</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Challenge Info Modal -->
<div class="modal fade" id="challengeModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Command Injection Level 16 - Challenge Information</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6>Objective:</h6>
                <p>Exploit advanced command injection using process substitution and shell expansion techniques.</p>
                
                <h6>Scenario:</h6>
                <p>You're testing a sophisticated Linux automation platform used by DevOps teams. The system executes shell scripts with complex parameters and supports advanced shell features like process substitution, creating opportunities for sophisticated attacks.</p>
                
                <h6>Learning Goals:</h6>
                <ul>
                    <li>Master advanced shell injection techniques</li>
                    <li>Understand process substitution vulnerabilities</li>
                    <li>Learn about complex shell expansion attacks</li>
                    <li>Practice sophisticated payload construction</li>
                </ul>
                
                <h6>Advanced Shell Features:</h6>
                <ul>
                    <li><strong>Process Substitution:</strong> <code>&lt;(command)</code> and <code>&gt;(command)</code></li>
                    <li><strong>Command Substitution:</strong> <code>$(command)</code> and <code>`command`</code></li>
                    <li><strong>Brace Expansion:</strong> <code>{a,b,c}</code> patterns</li>
                    <li><strong>Parameter Expansion:</strong> Variable manipulation</li>
                </ul>
                
                <h6>Real-World Context:</h6>
                <p>This challenge simulates vulnerabilities in:</p>
                <ul>
                    <li>CI/CD pipeline automation</li>
                    <li>Infrastructure as Code tools</li>
                    <li>System administration scripts</li>
                    <li>DevOps automation platforms</li>
                </ul>
                
                <h6>Advanced Techniques:</h6>
                <ul>
                    <li>Use process substitution to execute commands as file inputs</li>
                    <li>Combine multiple shell features for complex attacks</li>
                    <li>Exploit parameter parsing vulnerabilities</li>
                    <li>Chain commands using advanced shell operators</li>
                </ul>
                
                <h6>Hints:</h6>
                <ul>
                    <li>Try process substitution: <code>--input &lt;(whoami)</code></li>
                    <li>Use command substitution in parameters</li>
                    <li>Combine brace expansion with command injection</li>
                    <li>Test both script name and parameter injection</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
